{{!-- Layout --}}
{{!< default }}

{{#contentFor "M4_class_body"}}is-article{{/contentFor}}

{{!-- The container remains the flex parent, but we manage the infinite loading inside --}}
<div class="container mx-auto flex flex-col lg:flex-row my-10 js-infinite-container">

    {{#post}}
    {{!-- js-post-article added directly to the article tag to preserve all CSS relationships --}}
    <article class="post min-w-0 flex-auto js-post-article" data-url="{{url}}" data-title="{{title}}">
        {{#unless feature_image}}
            <div class="lg:pl-20">
                {{> "article/article-header"}}
                {{> "components/author-meta"}}
            </div>
        {{else}}
            {{> "article/article-header"}}
            {{> "components/author-meta"}}
        {{/unless}}

        {{> "article/article-media"}}
        {{> "article/article-body"}}

        <div class="article-comments">
            {{> "article/article-comments"}}
        </div>

        {{!-- Metadata for the infinite scroll engine --}}
        {{#next_post}}
            <div class="js-next-post-data hidden" data-url="{{url}}"></div>
        {{/next_post}}
    </article>
    {{/post}}

    {{!-- Sidebar stays outside the appended articles --}}
    {{> "sidebar"}}

    {{!-- Hidden fallback link for the engine to follow --}}
    {{#next_post}}
        <div class="w-full text-center py-8 pagination-fallback hidden">
             <a href="{{url}}" class="js-next-post-link">
                {{t "Read next"}}: <strong>{{title}}</strong>
             </a>
        </div>
    {{/next_post}}

</div>

{{!-- Related Articles --}}
{{> "article/article-related"}}