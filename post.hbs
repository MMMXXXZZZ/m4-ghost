{{!-- Layout --}}
{{!< default }}

{{#contentFor "M4_class_body"}}is-article{{/contentFor}}

{{!-- Main Container --}}
<div class="container mx-auto flex flex-col lg:flex-row my-10">

    {{!-- WRAPPER: Limits infinite scroll to just the article area, leaving sidebar fixed --}}
    <div class="js-infinite-container min-w-0 flex-auto">
        {{#post}}
        <article class="post js-post-article" data-url="{{url}}" data-title="{{title}}">
            {{#unless feature_image}}
                <div class="lg:pl-20">
                    {{> "article/article-header"}}
                    {{> "components/author-meta"}}
                </div>
            {{else}}
                {{> "article/article-header"}}
                {{> "components/author-meta"}}
            {{/unless}}

            {{> "article/article-media"}}
            {{> "article/article-body"}}

            <div class="article-comments">
                {{> "article/article-comments"}}
            </div>
            
            {{!-- Metadata for prefetching --}}
            {{#next_post}}
                <div class="js-next-post-data hidden" data-url="{{url}}"></div>
            {{/next_post}}
        </article>
        {{/post}}
    </div>

    {{!-- Sidebar stays at the top level of the flex container --}}
    {{> "sidebar"}}

    {{!-- NAVIGATION / FALLBACK --}}
    {{#post}}
    {{#next_post}}
        <div class="w-full text-center py-8 pagination-fallback">
             <a href="{{url}}" class="js-next-post-link inline-block px-6 py-3 border border-gray-200 rounded-full hover:bg-gray-50 transition-colors">
                {{t "Read next"}}: <strong>{{title}}</strong>
             </a>
        </div>
    {{/next_post}}
    {{/post}}

</div>

{{!-- Related Articles --}}
{{> "article/article-related"}}