<aside class="sidebar flex-none flex-grow-0 relative pt-14 pb-8 lg:w-80 lg:pt-0 lg:ml-16">
{{! Widget Most Read - partials/sidebar/sidebar-most-read.hbs }}
<style>
    #most-read-list {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
    }
</style>
<div class="mb-10">
  <style>
    /* Scope: hide timestamp by default, show when hovering the title */
    .most-read-title .most-read-timestamp { opacity: 0; transition: opacity .15s ease-out; }
    .most-read-title:hover .most-read-timestamp { opacity: 1; }
  </style>
  <h3 class="most-read-title uppercase mb-5 border-b pb-2 font-bold text-sm">
    Artículos más leídos
    <span id="most-read-timestamp" class="most-read-timestamp text-xs text-gray-500 ml-2"></span>
  </h3>
  <div id="most-read-list"></div>
</div>
<script>
  fetch('/content/data/most-read.json')
    .then(res => res.json())
    .then(data => {
      if (!data || !data.articles || data.articles.length === 0) {
        return; // Don't do anything if there's no data
      }

      const container = document.getElementById('most-read-list');
  const timestampContainer = document.getElementById('most-read-timestamp');
      
      // Build the HTML for the articles
      container.innerHTML = data.articles.map((article, idx) => `
        <div class="sidebar-post${idx < data.articles.length - 1 ? ' mb-4' : ''}">
          <a href="${article.url}" class="flex items-center">
            ${article.feature_image ? `
            <figure class="h-20 w-28 relative mr-4 flex-none bg-gray-100 rounded overflow-hidden img-hover">
                <img class="image-inset absolute img-hover-here blur-up lazyloaded" src="${article.feature_image}" data-src="${article.feature_image}" width="112" height="80" alt="${article.title}">
            </figure>
            ` : ''}
            <div class="py-2">
              <h3 class="text-base text-title lineClamp-2 leading-tight hover:text-primary">${article.title}</h3>
              <div class="text-sm text-gray-500 mt-1"><time class="datetime" datetime="${article.published_at}">${new Date(article.published_at).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</time></div>
            </div>
          </a>
        </div>
      `).join('');

      // Display the timestamp inside the title span (visible on title hover)
      if (data.last_updated) {
        const lastUpdated = new Date(data.last_updated);
        timestampContainer.textContent = `Actualizado: ${lastUpdated.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })} ${lastUpdated.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}`;
      }

      // Trigger the animation
      // We use a small timeout to allow the browser to apply the initial state before transitioning
      setTimeout(() => {
        container.style.maxHeight = container.scrollHeight + "px";
        container.style.opacity = 1;
      }, 10);

    })
    .catch(error => console.error('Error fetching most-read articles:', error));
</script>
    {{#is "post"}}
        {{#post}}
            {{#has tag="in-english"}}
                {{#get "posts" filter="tag:in-english+id:-{{id}}" limit="4" as |related_en_posts|}}
                    {{#if related_en_posts}}
                        {{> "sidebar/sidebar-story" widgetTitle="Related Articles (English)" widgetPosts=related_en_posts}}
                    {{/if}}
                {{/get}}
            {{/has}}
            {{!-- show the last 5 articles on the post page --}}
            {{#get "posts" limit="4" filter="id:-{{id}}" as |sidebar_latest_post| }}
                {{> "sidebar/sidebar-story" widgetTitle=(t "Latest Posts") widgetPosts=sidebar_latest_post}}
            {{/get}}
        {{/post}}
    {{else}}
        {{!-- show the featured 5 articles on the home page --}}
        {{#get "posts" filter="featured:true" limit="4" as |sidebar_featured_post|}}
            {{#if sidebar_featured_post}}
                {{> "sidebar/sidebar-story" widgetTitle=(t "Featured Posts") widgetPosts=sidebar_featured_post}}
            {{/if}}
        {{/get}}
    {{/is}}

    {{!-- Widget Sybscribe - partials/sidebar/sidebar-subscribers.hbs --}}
    {{#if @custom.disable_member_subscriptions}}{{#unless @member}}{{> "sidebar/sidebar-subscribers"}}{{/unless}}{{/if}}

    {{!-- Tag Cloud - partials/sidebar/sidebar-tag-cloud.hbs --}}
    <div class="sticky top-24">{{> "sidebar/sidebar-tag-cloud"}}</div>
</aside>